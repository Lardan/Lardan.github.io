var isMouseDown = !1;

function createScratchCard(a) {

    function I() {
        clearTimeout(a.resizeTrigger);
        a.resizeTrigger = setTimeout(x, 100)
    }

    function x() {
        window.removeEventListener("resize", x);
        y(!1);
        createScratchCard(a)
    }

    function J() {
        if ("undefined" == typeof a.foreground || a.hasEnded) return !1;
        "#" !== a.foreground.charAt(0) || 4 != a.foreground.length && 7 != a.foreground.length ? (c.topImage.crossOrigin = "anonymous", c.topImage.src = a.foreground, c.topImage.onload = function() {
            "undefined" !== typeof a.scratchedOverlay ? (h.drawImage(c.topImage, 0, 0, e, g), h.globalCompositeOperation = "destination-out", h.drawImage(a.scratchedOverlay, 0, 0, e, g)) : h.drawImage(c.topImage, 0, 0, e, g);
            D()
        }) : (h.fillStyle = a.foreground, h.fillRect(0, 0, e, g), "undefined" !== typeof a.scratchedOverlay && (h.globalCompositeOperation = "destination-out", h.drawImage(a.scratchedOverlay, 0, 0, e, g)), D());
        "undefined" != typeof a.percent && (c.endAt = a.percent);
        "undefined" != typeof a.coin ? (c.coinImage.src = a.coin, c.coinImage.onload = function() {
            z = c.coinImage.width * p;
            A = c.coinImage.height * p;
            d.style.width = z + "px";
            d.style.height = A + "px";
            d.style.background = 'url("' + a.coin + '") no-repeat left top';
            d.style.backgroundSize = "100%";
            f.style.cursor = "none";
            d.style.position = "absolute";
            d.style.display = "none";
            d.style.zIndex = "9000";
            d.style.top = 0;
            d.style.left = 0;
            d.style.pointerEvents = "none";
            B(d)
        }) : b.style.cursor = c.defaultCursor;
        "undefined" != typeof a.thickness && (c.thickness = a.thickness);
        "undefined" != typeof a.counter && (c.counter = a.counter, q = window[a.counter]);
        document.body.addEventListener("touchstart", function() {
            E = !0
        }, !1);
        b.addEventListener("mousedown", k);
        b.addEventListener("mousemove", k);
        document.addEventListener("mouseup", m);
        b.addEventListener("touchstart", k);
        b.addEventListener("touchmove", k);
        document.addEventListener("touchend", m);
        b.addEventListener("mouseover", s);
        b.addEventListener("mouseout", t);
        b.addEventListener("mousemove", u)
    }

    function F(a) {
        for (var b = 0, c = 0; a;) b += a.offsetLeft + a.clientLeft, c += a.offsetTop + a.clientTop, a = a.offsetParent;
        return {
            x: b,
            y: c
        }
    }

    function D() {
        window.addEventListener("resize", I);
        f.appendChild(b);
        f.appendChild(d);
        f.style.background = 'url("' + a.background + '") center center no-repeat';
        f.style.backgroundSize = "100%"
    }

    function k(a) {
        var e = !1;
        if ("touchmove" == a.type) a.preventDefault(), e = !1;
        else if ("mousedown" == a.type || "touchstart" == a.type) e = isMouseDown = !0;
        G(!0);
        if (isMouseDown) {
            var g = a.pageX - this.offsetLeft,
                d = a.pageY - this.offsetTop,
                k = F(f),
                g = a.pageX - k.x,
                d = a.pageY - k.y;
            if ("touchmove" == a.type || "touchstart" == a.type) H = 20, d = a.touches[0], g = d.pageX - k.x, d = d.pageY - k.y;
            h.save();
            h.globalCompositeOperation = "destination-out";
            h.beginPath();
            h.arc(g, d, c.thickness * p, 0, 2 * Math.PI, !1);
            h.closePath();
            h.fillStyle = "rgba(0, 0, 0, 1)";
            h.fill();
            h.restore();
            if ("touchmove" == a.type || "touchstart" == a.type || "touchend" == a.type) b.style.marginRight = "1px", b.style.marginRight = "0px";
            parseInt(G(e)) >= c.endAt && y(!0)
        }
    }

    function y(l) {
        b.removeEventListener("mousedown", k);
        b.removeEventListener("mousemove", k);
        document.removeEventListener("mouseup", m);
        b.removeEventListener("mouseover", s);
        b.removeEventListener("mouseout", t);
        b.removeEventListener("mousemove", u);
        b.removeEventListener("touchstart", k);
        b.removeEventListener("touchmove", k);
        document.removeEventListener("touchend", m);
        if (l && !a.hasEnded)
		a.hasEnded = !0,
		f.style.setProperty("cursor", "default", "important"),
		b.style.setProperty("cursor", "default", "important"),
		d.style.display = "none",
		delete a.scratchedOverlay,
		f.className = "scratchcase tada animated",
		0 != c.counter && "function" === typeof q && q(r, a),
		l = window[a.callback],
		"function" === typeof l && l(a);
        else if (!l && !a.hasEnded) {
            0 != v && (f.style.width = v);
            0 != w && (f.style.height = w);
            l = document.createElement("canvas");
            l.width = e;
            l.height = g;
            var h = l.getContext("2d");
            h.translate(0, 0);
            h.fillStyle = "rgba(10, 11, 12, 200)";
            h.fillRect(0, 0, e, g);
            h.globalCompositeOperation = "destination-out";
            h.drawImage(b, 0, 0, e, g);
            a.scratchedOverlay = l;
            f.style.backgroundImage = "none";
            f.innerHTML = ""
        }
    }

    function G(b) {
        if (0 == K++ % H || b) {
            b = 0;
            for (var f = h.getImageData(0, 0, e, g).data, d = 0, k = f.length - 20; d < k; d += 80) 0 < f[d] && b++;
            "undefined" === typeof C && (C = e * g / 20 - b);
            r = (100 - b / (e * g / 20 - C) * 100).toFixed(2)
        }
        0 != c.counter && "function" === typeof q && 0 < r && q(r, a);
        return r
    }

    function m() {
        isMouseDown = !1
    }

    function s(a) {
        E || (d.style.display = "block")
    }

    function t(a) {
        d.style.display = "none"
    }

    function u(a) {
        var b = F(f);
        d.style.left = a.pageX - b.x - z / 2 + "px";
        d.style.top = a.pageY - b.y - A / 2 + "px"
    }

    function B(a) {
        a.style.setProperty("-khtml-user-select", "none", "important");
        a.style.setProperty("-webkit-user-select", "none", "important");
        a.style.setProperty("-moz-user-select", "-moz-none", "important");
        a.style.setProperty("-ms-user-select", "none", "important");
        a.style.setProperty("user-select", "none", "important");
        a.style.setProperty("-webkit-touch-callout", "none", "important")
    }

    function n() {
        b.style.setProperty("cursor", "default", "important");
        document.removeEventListener("touchstart", n);
        document.removeEventListener("touchmove", n);
        document.removeEventListener("touchend", n)
    }
    var c = {
            topImage: new Image,
            bottomImage: new Image,
            coinImage: new Image,
            thickness: 20,
            endAt: 95,
            defaultCursor: "pointer",
            counter: !1
        },
        r = 0,
        K = 0,
        q, f, e, g, C, v = 0,
        w = 0,
        p = 1,
        E = !1,
        H = 10;
    "undefined" === typeof a.resizeTrigger && a.resizeTrigger;
    "undefined" === typeof a.hasEnded && (a.hasEnded = !1);
    "undefined" !== typeof a.width && "undefined" !== typeof a.height && (e = a.width, g = a.height);
    if (!window.HTMLCanvasElement) return f.innerHTML = "Your browser does not support HTML5 canvas tag.", !1;
    if ("undefined" != typeof a.container) f = a.container, e = f.offsetWidth, g = f.offsetHeight, f.style.setProperty("position", "relative", "important"), f.style.setProperty("padding", "0", "important"), B(f);
    else return !1;
    if ("undefined" == typeof a.background || a.hasEnded) return !1;
    c.bottomImage.onload = function() {
        0 != e && 0 == g ? (w = "auto", g = e / c.bottomImage.width * c.bottomImage.height, f.style.height = g + "px") : 0 == e && 0 != g && (v = "auto", e = g / c.bottomImage.height * c.bottomImage.width, f.style.width = e + "px");
        0 == e * g && (w = v = "auto", e = c.bottomImage.width, g = c.bottomImage.height, f.style.width = e + "px", f.style.height = g + "px");
        "undefined" == typeof a.responsiveRatio ? a.responsiveRatio = e / c.bottomImage.width : p = e / c.bottomImage.width;
        p = e / c.bottomImage.width / a.responsiveRatio;
        b.width = e;
        b.height = g;
        B(b);
        J()
    };
    c.bottomImage.src = a.background;
    var b = document.createElement("canvas");
    b.className = "scratchcard-Overlay";
    var h = b.getContext("2d");
    h.translate(0, 0);
    var d = document.createElement("div");
    d.className = "scratchcard-Cursor";
    var z = 0,
        A = 0;
    document.addEventListener("touchstart", n);
    document.addEventListener("touchmove", n);
    document.addEventListener("touchend", n);
    a.locked = !1;
    a.container.lock = function(d) {
        "undefined" !== typeof d && (a.locked = !d);
        a.locked ? (b.addEventListener("mousedown", k), b.addEventListener("mousemove", k), document.addEventListener("mouseup", m), b.addEventListener("mouseover", s), b.addEventListener("mouseout", t), b.addEventListener("mousemove", u), b.addEventListener("touchstart", k), b.addEventListener("touchmove", k), document.addEventListener("touchend", m), "undefined" == typeof a.coin && (b.style.cursor = c.defaultCursor)) : (b.removeEventListener("mousedown", k), b.removeEventListener("mousemove", k), document.removeEventListener("mouseup", m), b.removeEventListener("mouseover", s), b.removeEventListener("mouseout", t), b.removeEventListener("mousemove", u), b.removeEventListener("touchstart", k), b.removeEventListener("touchmove", k), document.removeEventListener("touchend", m), b.style.cursor = "default");
        a.locked = !a.locked
    };
    a.container.restart = function() {
        a.hasEnded = !1;
        y(!1);
        a.scratchedOverlay = void 0;
        window.removeEventListener("resize", x);
        createScratchCard(a)
    };
    a.container.clean = function() {
        a.hasEnded = !0;
        a.container.lock(!0);
        delete a.scratchedOverlay;
        f.innerHTML = "";
        f.style.setProperty("cursor", "default")
    }
	
};